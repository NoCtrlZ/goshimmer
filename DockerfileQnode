FROM golang:1.13-alpine
RUN apk add --no-cache git gcc g++

# Get Env Variable From Docker Compose
ARG NODE_DIR

# Set the current Working Directory inside the container
RUN mkdir /goshimmer
WORKDIR /goshimmer

# Download dependencies
COPY go.mod .
COPY go.sum .
RUN go mod download

# Copy everything from the current directory to the PWD(Present Working Directory) inside the container
COPY . .

# Build
RUN go build

# Change Directory
WORKDIR /goshimmer/${NODE_DIR}

EXPOSE ${NODE_PORT}

ENTRYPOINT ["../../goshimmer"]
